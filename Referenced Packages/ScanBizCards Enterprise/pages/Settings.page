<apex:page showHeader="true" sidebar="true" controller="scanbizcards.SettingsCtlr" action="{!verifyDefaultExists}">
    <script type="text/javascript" src="{!URLFOR($Resource.ScanBizCardsPackage, 'jquery-1.10.2.min.js')}"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.ScanBizCardsPackage, 'jquery-ui.min.js')}"></script>
    <apex:stylesheet value="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'jquery-ui.min.css')}" />
    <!--<apex:stylesheet value="{!$Resource.ScanBizCardsCSS}" /> -->
    
    <script type="text/javascript">
        if (navigator.userAgent.indexOf('Firefox') != -1) {//Firefox
            document.write('<link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'main_ff.css')}" />');
        } else if (navigator.userAgent.indexOf('Chrome') != -1) {//Chrome
            document.write('<link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'main.css')}" />');
        } else if(navigator.userAgent.indexOf('Safari') != -1) {//Safari
            document.write('<link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'main.css')}" />');
        } else {
            document.write('<link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'main_ie.css')}" />');
        }
        
        $j = jQuery.noConflict();
        
        var recordID;
        
        function popup(recordId) {
            var buttons = $j('.btn');
            $j('.popup').show();
            $j('.blackBackground').show();
            $j(buttons).toggleClass('btnDisabled', true).attr('disabled', 'disabled');
            $j('.processing').hide();
            recordID = recordId;
        }        
        
        
        function closePopup() {
            var buttons = $j('.btn');
            $j('.popup').hide();
            $j('.blackBackground').hide();
            $j('.processing').hide();
            $j('.buttons').show();
            $j(buttons).toggleClass('btnDisabled', false).attr('disabled', null);
        }
        
        function processing() {
            $j('.processing').show();
            $j('.content').hide();
            $j('.buttons').hide();
        }
    </script>
  
    <!-- <apex:stylesheet value="{!URLFOR($Resource.ScanBizCardsPackage, 'main.css')}" /> -->
    <apex:stylesheet value="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'font-awesome-4.1.0/css/font-awesome.min.css')}" />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.ScanBizCardsPackage, 'jquery.tinyscrollbar.min.js')}"></script>
    <apex:form id="myForm">
        <div class="header">
            <div class="logoSection">
                <apex:image url="{!URLFOR($Resource.scanbizcards__ScanBizCardsPackage, 'SBC_Logo_White.png')}"/>
            </div>
            <div class="linkSection">
                <span class="started"><a href="https://appexchange.salesforce.com/servlet/servlet.FileDownload?file=00P3000000KZQynEAH" target="_blank">Getting Started</a></span>
                <span class="support"><a href="http://support.circleback.com" target="_blank">Support</a></span>
            </div>
        </div>
        <div class="topSection">
            <div class="topHeader">
                <span>Settings Profiles</span>
            </div>
            <div class="buttons">
                <apex:commandLink styleClass="customButton" value="Load Record Type" style="margin-right:10px;width:140px !important;" 
                                  onclick="window.open('{!$Page.scanbizcards__SBRecordTypeProcessor}','_blank','width=317, height=100'); return false;" rendered="{!displayRecordTypeBtn}"/>
                <apex:commandLink styleClass="customButton" value="Add New" onclick="window.location.href='{!$Page.scanbizcards__EditSettings}'; return false;" rendered="{!preloaded}"/>
            </div>
        </div>
        <apex:outputPanel layout="block" id="settingsList" styleclass="tableSection" style="margin-top:62px; clear: both;">
            <div class="headerContent">
                <div class="Table1">
                    <div class="Heading" style="margin-bottom:-10px">
                        <div class="headerCell" style="width: 2%;height:0px;">
                            <p></p>
                        </div>
                        <div class="headerCell" style="width: 2%;height:0px;">
                            <p></p>
                        </div>
                        <div class="headerCell" style="width: 20%;height:0px;">
                            <p>Profile Name</p>
                        </div>
                        <div class="headerCell" style="width: 20%;height:0px;">
                            <p>Type</p>
                        </div>
                        <div class="headerCell" style="width: 56%;height:0px;">
                            <p>Applies To</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="Table2" style="border: 1px solid #dedede;border-radius:2px;width:99.7%;">
                <apex:repeat value="{!settings}" var="setting">
                    <div class="Row">
                        <div class="Cell" style="width: 2%;height:0px !important;">
                            <apex:outputPanel rendered="{!preloaded}">
                                <a href="{!$Page.EditSettings}?id={!setting.Id}"><i class="fa fa-pencil" style="font-size: 12px; color: #bababa;"></i></a>
                            </apex:outputPanel>
                        </div>
                        <div class="Cell" style="width: 2%;height:0px !important;">
                            <!-- Don't show delete button for default profile -->
                            <apex:commandLink rendered="{!setting.Name != 'Default'}" onclick="popup('{!JSENCODE(setting.Id)}');return false;">
                                <i class="fa fa-trash-o" style="font-size: 12px; color: #bababa;"></i>
                            </apex:commandLink>
                        </div>
                        <div class="Cell" style="width: 20%;height:0px !important;">
                            <apex:outputField value="{!setting.Name}" />
                        </div>
                        <div class="Cell" style="width: 20%;height:0px !important;">
                            <apex:outputField value="{!setting.scanbizcards__Type__c}" />
                        </div>
                        <div class="Cell" style="width: 56%;height:0px !important;">
                            <apex:outputField value="{!setting.scanbizcards__Applies_To__c}" />
                        </div>
                    </div>
                </apex:repeat>
            </div>
        </apex:outputPanel>
        <apex:actionFunction name="deleteRecord" action="{!onDelete}" oncomplete="closePopup();" rerender="settingsList">
            <apex:param name="itemToDelete" assignTo="{!itemToDelete}" value=""/>
        </apex:actionFunction>
        <div class="blackBackground"></div>
        <div class="popup" style="display:none;">
            <div class="titleBar">
                <span class="title">Delete Profile?</span>
                <div class="closeText"><a href="#" onclick="closePopup(); return false;"><i class="fa fa-times"></i></a></div>
            </div>
            <div class="title-seperator"></div>
            <div class="content">
                Are you sure you want to delete this profile?
            </div>
            <div class="processing" style="margin:20px;">
                <img src="{!$Resource.AnimatedSpinner}" /> Processing...
            </div>
            <div class="title-seperator"></div>
            <div class="buttons">
                <span><a class="customButton" href="#" style="background-color:#bababa;" onclick="closePopup(); return false;">No</a></span>
                <span><a class="customButton" href="#" onclick="processing();deleteRecord(recordID);return false;">Yes</a></span>
            </div>
        </div>
    </apex:form>
</apex:page>